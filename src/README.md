# いまなにしてる？ - タイムラインアプリ

シンプルなタイムラインアプリです。みんなで「今何してる？」をシェアしましょう！

## 機能

- 📝 シンプルな投稿機能（最大50文字）
- 👤 名前ベースのログイン（パスワード不要）
- 🍪 ログイン状態の保持（Cookie）
- 🔄 3秒ごとに自動更新
- 💾 SQLiteデータベースで永続化
- 📊 最新1000件の投稿を表示

## 必要な環境

- **Node.js**: バージョン 22 以上
- **npm**: Node.jsに付属

## 初回セットアップ

### 1. 依存関係のインストール

```bash
cd src
npm install
```

これで以下のパッケージがインストールされます：
- `express`: Webサーバーフレームワーク
- `better-sqlite3`: 軽量なSQLiteデータベース
- `cookie-parser`: Cookie管理

### 2. サーバーの起動

```bash
npm start
```

サーバーが起動すると、以下のようなメッセージが表示されます：

```
╔═══════════════════════════════════════════════════╗
║                                                   ║
║     ✨ いまなにしてる？サーバー起動しました ✨       ║
║                                                   ║
║     http://localhost:3000                        ║
║                                                   ║
╚═══════════════════════════════════════════════════╝
```

### 3. ブラウザでアクセス

ブラウザで以下のURLを開きます：

```
http://localhost:3000
```

## 開発モード

ファイルの変更を自動検知して再起動する開発モードで実行できます（Node.js 18.11.0以降）：

```bash
npm run dev
```

> **注意**: Node.js 22を使用している場合、`--watch`フラグがデフォルトで利用可能です。

## サーバーの操作

### サーバーの起動

```bash
cd src
npm start
```

### サーバーの停止

サーバーが起動しているターミナルで、以下のいずれかの方法で停止します：

- **Windows**: `Ctrl + C`
- **Mac/Linux**: `Ctrl + C`

Graceful shutdownが実装されているため、データベース接続が正常に閉じられます。

### サーバーの再起動

1. サーバーを停止（`Ctrl + C`）
2. 再度起動（`npm start`）

## データベース

### データの保存場所

データは `src/timeline.db` に SQLite データベースとして保存されます。

### データの永続化

- サーバーを停止・再起動しても、データは保持されます
- データベースファイルを削除すると、すべての投稿が消去されます

### データベースのリセット

すべての投稿を削除したい場合：

```bash
# サーバーを停止してから実行
cd src
rm timeline.db
# または Windows の場合
del timeline.db
```

次回起動時に、新しいデータベースファイルが自動作成されます。

## プロジェクト構造

```
src/
├── server.js          # Expressサーバーのメインファイル
├── db.js             # データベース操作（better-sqlite3）
├── index.html        # フロントエンドUI
├── package.json      # プロジェクト設定と依存関係
├── timeline.db       # SQLiteデータベース（自動生成）
└── README.md         # このファイル
```

## API エンドポイント

### 投稿の取得

```
GET /api/posts
```

最新1000件の投稿を取得します。

### 新規投稿

```
POST /api/posts
Content-Type: application/json

{
  "author": "ユーザー名",
  "content": "投稿内容",
  "timestamp": "2025-10-26T12:00:00.000Z"
}
```

### 指定時刻以降の投稿を取得（ポーリング用）

```
GET /api/posts/since/:timestamp
```

指定されたタイムスタンプ以降の新しい投稿を取得します。

## トラブルシューティング

### ポートが使用中のエラー

```
Error: listen EADDRINUSE: address already in use :::3000
```

**解決方法**:
1. 別のプロセスがポート3000を使用しています
2. 以前のサーバープロセスを停止してください
3. または、環境変数でポートを変更します：

```bash
# Windows PowerShell
$env:PORT=3001; npm start

# Windows コマンドプロンプト
set PORT=3001 && npm start

# Mac/Linux
PORT=3001 npm start
```

### データベースエラー

```
Error: SqliteError: database is locked
```

**解決方法**:
1. サーバーを完全に停止します
2. 他のプロセスが `timeline.db` を開いていないか確認します
3. 再起動します

### 依存関係のエラー

```
Error: Cannot find module 'express'
```

**解決方法**:
```bash
cd src
npm install
```

## 将来的な拡張予定

- ✅ ローカル開発環境（完了）
- 🔜 Vercelへのデプロイ
- 🔜 WebSocketによるリアルタイム通信
- 🔜 画像添付機能
- 🔜 いいね機能
- 🔜 削除機能

## 使用方法

1. ブラウザで `http://localhost:3000` を開く
2. ニックネームを入力してログイン
3. 「今何してる？」を投稿
4. タイムラインでみんなの投稿を確認
5. 3秒ごとに自動的に新しい投稿が表示されます

## ライセンス

MIT

---

**作成者**: Canva AI + カスタム開発
**作成日**: 2025年10月

